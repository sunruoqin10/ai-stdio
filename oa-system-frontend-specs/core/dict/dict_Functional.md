# 数据字典功能需求规范

> **规范类型**: 第一层 - 功能需求规范
> **模块**: 数据字典
> **版本**: v1.0.0
> **创建日期**: 2026-01-09

---

## 📋 目录

- [1. 功能概述](#1-功能概述)
- [2. 功能需求](#2-功能需求)
- [3. 业务规则](#3-业务规则)

---

## 1. 功能概述

### 1.1 模块简介

数据字典模块是OA系统的基础配置模块,用于管理系统中的各种枚举类型、下拉选项、状态码等基础数据。通过集中管理这些数据,可以避免硬编码,提高系统的灵活性和可维护性。

### 1.2 功能目标

- 集中管理系统中的字典类型和字典项
- 提供字典数据的CRUD操作
- 支持字典分类管理(系统字典/业务字典)
- 支持字典排序和启用/禁用
- 提供字典数据的缓存机制
- 支持字典数据的导入导出

### 1.3 用户角色

- **系统管理员**: 全部权限(查看、新增、编辑、删除所有字典)
- **部门管理员**: 仅查看权限
- **普通用户**: 仅查看权限

---

## 2. 功能需求

### 2.1 用户故事

```
作为系统管理员,
我想要集中管理系统中的各种枚举数据,
以便在多个模块中统一使用,避免数据不一致。

作为系统管理员,
我想要灵活调整字典项的顺序和状态,
以便控制业务模块中显示的选项顺序。

作为开发者,
我想要通过API获取字典数据,
以便在业务模块中快速使用下拉选择等功能。
```

### 2.2 功能清单

#### 2.2.1 字典类型管理

**功能概述**: 管理系统中的字典分类,如"员工状态"、"资产状态"、"审批状态"等。

- [x] 字典类型列表
  - 表格展示所有字典类型
  - 显示字典编码、名称、描述、项数量、状态、创建时间
  - 支持搜索(按编码/名称)
  - 支持筛选(系统字典/业务字典)
- [x] 新增字典类型
  - 字典编码(唯一标识,如:employee_status)
  - 字典名称(如:员工状态)
  - 字典描述
  - 字典类别(系统字典/业务字典)
  - 验证编码唯一性
- [x] 编辑字典类型
  - 可编辑名称、描述
  - 字典编码不可修改
- [x] 删除字典类型
  - 二次确认
  - 检查是否被引用
  - 如果有字典项,提示先删除字典项
- [x] 查看字典项
  - 点击字典类型跳转到字典项列表
  - 显示该类型下的所有字典项

#### 2.2.2 字典项管理

**功能概述**: 管理每个字典类型下的具体选项,如"在职"、"离职"、"试用期"等。

- [x] 字典项列表
  - 按字典类型分组显示
  - 显示项标签、项值、排序、状态、创建时间
  - 支持拖拽排序
  - 支持搜索(按标签/值)
  - 支持筛选(启用/禁用)
- [x] 新增字典项
  - 所属字典类型
  - 项标签(显示文本,如:在职)
  - 项值(实际值,如:active)
  - 排序序号(自动生成,可调整)
  - 颜色类型(primary/success/warning/danger/info)
  - 扩展属性(JSON格式,可选)
  - 验证项值在同一字典类型下的唯一性
- [ ] 编辑字典项
  - 可编辑标签、值、颜色、排序
  - 支持启用/禁用
- [ ] 删除字典项
  - 二次确认
  - 检查是否被业务数据引用
- [ ] 批量操作
  - 批量启用/禁用
  - 批量删除
  - 批量修改排序

#### 2.2.3 字典查询

**功能概述**: 提供便捷的字典数据查询功能。

- [ ] 树形结构展示
  - 左侧: 字典类型树
  - 右侧: 字典项列表
  - 点击类型树节点刷新右侧列表
- [ ] 快速搜索
  - 关键词搜索(搜索所有字典的标签和值)
  - 高亮显示匹配结果
- [ ] 字典预览
  - 鼠标悬停显示字典详情
  - 显示扩展属性

#### 2.2.4 数据导入导出

- [ ] 导出字典
  - 按字典类型导出
  - 支持Excel格式
  - 包含字典类型和字典项
- [ ] 导入字典
  - Excel模板下载
  - 数据验证
  - 错误提示
  - 导入结果反馈(成功/失败数量)

#### 2.2.5 系统字典管理

**功能概述**: 系统自带的字典数据,不可删除,可编辑项值和标签。

- [ ] 系统字典列表
  - 标识为系统字典
  - 显示锁定图标
  - 删除按钮禁用
- [ ] 系统字典项管理
  - 可编辑标签、值、颜色
  - 可禁用(不可删除)
  - 显示"系统"标识

---

## 3. 业务规则

### 3.1 字典编码规则

字典编码是字典类型的唯一标识,格式要求:
- 全小写字母
- 使用下划线分隔
- 格式: 模块_实体_属性
- 示例:
  - `employee_status` (员工状态)
  - `asset_status` (资产状态)
  - `approval_status` (审批状态)

### 3.2 字典项值规则

字典项值是字典项的实际值:
- 建议使用小写字母和数字
- 使用下划线分隔(可选)
- 在同一字典类型下必须唯一
- 示例:
  - `active`, `resigned`, `probation`
  - `in_stock`, `in_use`, `borrowed`

### 3.3 字典排序规则

- 排序序号: 数字类型,越小越靠前
- 新增字典项自动设置为: 当前最大序号 + 10
- 支持手动修改排序序号
- 支持拖拽排序(自动更新序号)

### 3.4 字典状态规则

**字典类型状态**:
- 启用: 该字典类型可用,可以在业务模块中使用
- 禁用: 该字典类型不可用,已使用的地方不受影响

**字典项状态**:
- 启用: 该字典项可选,显示在业务模块中
- 禁用: 该字典项不可选,不影响已使用的历史数据

### 3.5 字典分类规则

**系统字典**:
- 系统核心功能使用的字典
- 不可删除
- 标识为"系统"
- 示例: 员工状态、资产状态、审批状态

**业务字典**:
- 业务模块自定义的字典
- 可完全管理(增删改查)
- 标识为"业务"
- 示例: 项目优先级、客户等级、产品分类

### 3.6 字典颜色规则

字典项可选颜色类型:
- `primary`: 主要色(蓝色)
- `success`: 成功色(绿色)
- `warning`: 警告色(黄色)
- `danger`: 危险色(红色)
- `info`: 信息色(灰色)

颜色在业务模块中用于状态标签展示。

### 3.7 权限控制规则

#### 3.7.1 数据权限

| 角色 | 查看权限 | 编辑权限 | 删除权限 |
|------|---------|---------|---------|
| 系统管理员 | 所有字典 | 所有信息 | ✅ |
| 部门管理员 | 所有字典 | ❌ | ❌ |
| 普通用户 | 所有字典 | ❌ | ❌ |

#### 3.7.2 操作权限

- 新增字典类型: 仅系统管理员
- 删除字典类型: 仅系统管理员(需二次确认)
- 编辑字典类型: 仅系统管理员
- 新增字典项: 仅系统管理员
- 删除字典项: 仅系统管理员
- 编辑字典项: 仅系统管理员
- 导入导出: 仅系统管理员

### 3.8 引用检查规则

**删除字典类型时**:
- 检查是否存在字典项
- 如果存在,提示"请先删除该字典类型下的所有字典项"

**删除字典项时**:
- 检查是否被业务数据引用
- 如果被引用,提示"该字典项已被使用,无法删除"
- 建议先禁用,再清理引用数据

### 3.9 缓存规则 ⭐ UPDATED

#### 3.9.1 字典缓存机制

**缓存管理类实现**:
```typescript
class DictCacheManager {
  private cache: Map<string, CacheItem> = new Map()
  private readonly CACHE_TTL = 3600000 // 1小时

  // 获取缓存
  get(dictTypeCode: string): DictData | null

  // 设置缓存
  set(dictTypeCode: string, data: DictData): void

  // 清除缓存
  clear(dictTypeCode?: string): void

  // 批量清除缓存
  clearBatch(dictTypeCodes: string[]): void
}
```

**缓存策略**:
- 字典数据加载后缓存到内存
- 缓存key: `dict:${dictCode}`
- 缓存时间: 1小时(3600000ms)
- 定时清理过期缓存
- 字典数据变更时自动清除对应缓存

**缓存使用示例**:
```typescript
import { dictCacheManager } from '@/modules/dict/utils/cache'

// 获取字典数据(优先使用缓存)
const data = dictCacheManager.get('employee_status')
if (data) {
  return data
}

// 从API加载
const response = await dictApi.getDictData('employee_status')

// 设置缓存
dictCacheManager.set('employee_status', response.data)
```

#### 3.9.2 缓存失效时机

**自动失效**:
- 字典类型更新时 → 清除该字典类型缓存
- 字典项增删改时 → 清除对应字典类型缓存
- 缓存过期(1小时后) → 自动清除

**手动失效**:
```typescript
// 清除特定字典类型缓存
dictCacheManager.clear('employee_status')

// 清除所有缓存
dictCacheManager.clear()

// 批量清除多个字典类型
dictCacheManager.clearBatch(['employee_status', 'asset_status'])
```

#### 3.9.3 Mock数据支持 ⭐ NEW

**Mock数据结构**:
- 预置系统字典数据
- Mock API实现
- 开发环境使用Mock,生产环境使用真实API
- 支持实时增删改查操作

**API切换**:
```typescript
// 开发环境使用Mock API
export function getDictTypeList(params) {
  return mockApi.mockGetDictTypeList(params)

  // 生产环境切换为真实API
  // return request.get('/api/dict/types', { params })
}
```

### 3.10 数据验证规则

#### 3.10.1 字典类型验证

- 字典编码: 必填,唯一,格式验证(小写字母+下划线)
- 字典名称: 必填,2-50字符
- 字典描述: 可选,最多200字符
- 字典类别: 必填,枚举值(system/business)

#### 3.10.2 字典项验证

- 所属字典类型: 必填
- 项标签: 必填,2-50字符
- 项值: 必填,唯一(同一字典类型下),1-50字符
- 排序序号: 必填,数字,≥0
- 颜色类型: 必填,枚举值(primary/success/warning/danger/info)
- 扩展属性: 可选,JSON格式

---

## 附录

### A. 功能优先级

**P0 (核心功能)**:
- 字典类型CRUD
- 字典项CRUD
- 字典列表展示
- 字典搜索筛选

**P1 (重要功能)**:
- 拖拽排序
- 树形结构展示
- 导入导出
- 字典缓存

**P2 (增强功能)**:
- 批量操作
- 字典预览
- 扩展属性管理
- 引用检查

### B. 功能测试要点

**功能测试**:
- 字典类型CRUD完整性
- 字典项CRUD完整性
- 搜索筛选准确性
- 排序功能正确性
- 导入导出数据完整性

**业务规则测试**:
- 编码唯一性验证
- 项值唯一性验证
- 引用检查逻辑
- 缓存更新机制
- 权限控制有效性

**用户体验测试**:
- 拖拽排序流畅性
- 树形展开/折叠交互
- 错误提示友好性
- 响应速度合理性

### C. 预置字典数据

系统初始化时预置以下字典类型:

**员工管理**:
- `employee_status`: 员工状态(active/resigned/suspended)
- `employee_gender`: 性别(male/female)
- `probation_status`: 试用期状态(probation/regular)

**资产管理**:
- `asset_status`: 资产状态(in_stock/in_use/borrowed/maintenance/scrapped)
- `asset_category`: 资产分类

**审批管理**:
- `approval_status`: 审批状态(pending/approved/rejected)
- `approval_type`: 审批类型

**系统通用**:
- `yes_no`: 是否(yes/no)
- `enabled_disabled`: 启用状态(enabled/disabled)

---

**文档版本**: v1.0.0
**创建人**: AI开发助手
**最后更新**: 2026-01-09
