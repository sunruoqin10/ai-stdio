# 规范文档三层架构说明

> **版本**: v2.0
> **更新日期**: 2026-01-09

---

## 📋 什么是三层架构规范文档?

三层架构规范文档将原来的单层文档拆分为**三个独立的层次**,每层关注不同的维度:

```
第一层: 功能需求规范 (Functional Spec)
    ↓
第二层: 技术实现规范 (Technical Spec)
    ↓
第三层: UI/UX规范 (Design Spec)
```

---

## 🔄 新旧版本对比

### 旧版本 (v1.0) - 单层结构

```
1. 功能概述
2. 功能需求
3. 数据结构
4. API接口
5. 验证规则
6. UI规范
7. 业务规则
8. 自动化功能
9. 参考实现
10. 特殊说明
```

**问题**:
- 功能、技术、设计混在一起
- 难以快速定位需要的部分
- AI理解时层次不够清晰

### 新版本 (v2.0) - 三层结构

```
第一层: 功能需求规范 (Functional Spec)
├── 1. 功能概述
├── 2. 用户故事
├── 3. 功能清单
├── 4. 交互流程
└── 5. 业务规则

第二层: 技术实现规范 (Technical Spec)
├── 6. 数据结构
├── 7. API接口
├── 8. 验证规则
├── 9. 算法实现
└── 10. 自动化功能

第三层: UI/UX规范 (Design Spec)
├── 11. 页面布局
├── 12. 组件选择
├── 13. 交互规范
├── 14. 样式规范
└── 15. 响应式设计
```

**优势**:
- ✅ 清晰的层次划分
- ✅ 关注点分离
- ✅ 便于AI理解
- ✅ 易于团队协作
- ✅ 支持独立更新

---

## 📚 三层详解

### 第一层: 功能需求规范 (Functional Spec)

**核心问题**: "做什么?"

**目标读者**:
- 产品经理
- 业务分析师
- UI/UX设计师
- 开发工程师

**主要内容**:

#### 1. 功能概述
- 模块简介
- 业务价值
- 目标用户
- 功能目标

#### 2. 用户故事
```
作为 [角色],
我想要 [功能],
以便 [价值/目标]
```

**验收标准**: 明确的完成标准

#### 3. 功能清单
- 按优先级分类(P0/P1/P2)
- 详细的功能点
- 功能间依赖关系

#### 4. 交互流程
- 核心流程图(Mermaid)
- 页面跳转流程
- 数据流转(sequence diagram)

#### 5. 业务规则
- 数据约束(唯一性、格式、范围)
- 业务逻辑(计算规则、状态流转)
- 权限规则(角色、数据范围)
- 边界条件(异常情况处理)

**示例**:
```markdown
### 5.1 数据约束
| 规则类型 | 规则说明 | 错误提示 |
|---------|---------|---------|
| 唯一性 | 邮箱必须唯一 | "该邮箱已被使用" |
| 格式 | 手机号: 1[3-9]\\d{9} | "请输入正确的手机号" |

### 5.2 业务逻辑
**规则1: 工龄计算**
```
工龄 = 当前年份 - 入职年份
如果当前月份 < 入职月份,工龄 - 1
最小值: 0年
```
```

---

### 第二层: 技术实现规范 (Technical Spec)

**核心问题**: "怎么做?"

**目标读者**:
- 前端开发工程师
- 后端开发工程师
- 测试工程师

**主要内容**:

#### 6. 数据结构
- TypeScript类型定义
- 字段说明表
- 数据库设计(SQL)

**示例**:
```typescript
interface Employee {
  id: string
  name: string
  phone: string
  // ...
}
```

#### 7. API接口
- RESTful API设计
- 请求/响应格式
- 错误码定义

**示例**:
```typescript
// 获取员工列表
GET /api/employees?page=1&pageSize=20

interface ListResponse {
  code: number
  message: string
  data: {
    list: Employee[]
    total: number
  }
}
```

#### 8. 验证规则
- 前端验证规则
- 后端验证规则
- 业务逻辑验证

**示例**:
```typescript
const rules = {
  phone: [
    { required: true, message: '请输入手机号' },
    { pattern: /^1[3-9]\d{9}$/, message: '格式错误' }
  ]
}
```

#### 9. 算法实现
- 核心算法伪代码
- 复杂度分析
- 边界条件处理

**示例**:
```typescript
/**
 * 计算工龄
 */
function calculateWorkYears(joinDate: string): number {
  const join = new Date(joinDate)
  const now = new Date()
  let years = now.getFullYear() - join.getFullYear()

  if (now.getMonth() < join.getMonth()) {
    years--
  }

  return Math.max(0, years)
}
```

#### 10. 自动化功能
- 自动计算逻辑
- 自动触发时机
- 定时任务配置

**示例**:
```typescript
// 每月1号更新工龄
schedule.scheduleJob({ date: 1, hour: 0 }, async () => {
  const employees = await getAllActiveEmployees()
  for (const employee of employees) {
    const workYears = calculateWorkYears(employee.joinDate)
    await updateEmployee(employee.id, { workYears })
  }
})
```

---

### 第三层: UI/UX规范 (Design Spec)

**核心问题**: "长什么样?"

**目标读者**:
- UI/UX设计师
- 前端开发工程师

**主要内容**:

#### 11. 页面布局
- ASCII布局图
- 布局说明
- 响应式布局

**示例**:
```
┌─────────────────────────────────────┐
│  PageHeader: 标题  [新增] [导出]     │
├─────────┬───────────────────────────┤
│ Filter  │    Data Table             │
│ Panel   │    - Table                │
│         │    - Card                 │
└─────────┴───────────────────────────┘
```

#### 12. 组件选择
- Element Plus组件映射
- 自定义组件
- 组件配置

**示例**:
| 功能 | 组件 | 配置 |
|------|------|------|
| 数据表格 | el-table | stripe, border |
| 表单 | el-form | :model, :rules |

#### 13. 交互规范
- 加载状态
- 错误处理
- 操作反馈
- 二次确认

**示例**:
```vue
<el-table v-loading="loading" element-loading-text="加载中...">
  <!-- 表格内容 -->
</el-table>
```

#### 14. 样式规范
- 颜色系统
- 字体系统
- 间距系统
- 圆角系统
- 阴影系统

**示例**:
```scss
$primary-color: #1890FF;
$font-size-base: 14px;
$spacing-base: 16px;
$border-radius-base: 4px;
```

#### 15. 响应式设计
- 断点系统
- 响应式布局
- 移动端适配

**示例**:
```scss
@media (max-width: 768px) {
  .employee-list {
    grid-template-columns: 1fr;
  }
}
```

---

## 🎯 使用指南

### 1. 阅读规范文档

**按照角色阅读**:

**产品经理/业务分析师**:
- 重点阅读: 第一层 (Functional Spec)
- 关注: 用户故事、功能清单、业务规则

**UI/UX设计师**:
- 重点阅读: 第一层、第三层
- 关注: 交互流程、页面布局、样式规范

**前端开发工程师**:
- 重点阅读: 第二层、第三层
- 关注: 数据结构、API接口、组件选择、样式规范

**后端开发工程师**:
- 重点阅读: 第一层、第二层
- 关注: 业务规则、数据结构、API接口、算法实现

**测试工程师**:
- 重点阅读: 第一层、第二层
- 关注: 业务规则、验证规则、错误处理

### 2. 编写规范文档

**步骤**:

1. **先写第一层** (Functional Spec)
   - 和产品经理确认需求
   - 编写用户故事和验收标准
   - 绘制交互流程图
   - 定义业务规则

2. **再写第二层** (Technical Spec)
   - 设计数据结构
   - 定义API接口
   - 编写算法实现
   - 确定验证规则

3. **最后写第三层** (Design Spec)
   - 设计页面布局
   - 选择UI组件
   - 定义样式规范
   - 考虑响应式

### 3. AI辅助开发

**提示词示例**:

```bash
# 生成功能层
"根据规范文档的第一层(功能需求规范),生成员工管理模块的用户故事和功能清单"

# 生成技术层
"根据规范文档的第二层(技术实现规范),生成员工管理的数据结构和API接口"

# 生成UI层
"根据规范文档的第三层(UI/UX规范),生成员工管理列表页的布局和组件"

# 生成完整模块
"根据 specs/core/employee-spec.md 三层架构规范,生成完整的员工管理模块:
- 参考第一层理解业务需求
- 参考第二层实现技术方案
- 参考第三层实现UI设计"
```

---

## 📊 迁移指南

### 从v1.0迁移到v2.0

**步骤**:

1. **备份旧文档**
   ```bash
   cp specs/core/employee-spec.md specs/core/employee-spec-v1-backup.md
   ```

2. **使用新模板**
   - 参考 `specs/_template/spec-template-v2.md`
   - 按三层结构重新组织内容

3. **内容映射**
   ```
   v1.0 → v2.0
   ────────────────────────
   1. 功能概述 → 1. 功能概述
   2. 功能需求 → 2. 用户故事 + 3. 功能清单
   3. 数据结构 → 6. 数据结构
   4. API接口 → 7. API接口
   5. 验证规则 → 8. 验证规则
   6. UI规范 → 11-15 (UI/UX规范)
   7. 业务规则 → 5. 业务规则
   8. 自动化功能 → 10. 自动化功能
   ```

4. **更新交叉引用**
   - 更新README中的引用
   - 更新其他文档中的链接

---

## 💡 最佳实践

### 1. 保持层次独立

**原则**: 每一层应该可以独立理解和修改

**示例**:
- ✅ 第一层不包含技术实现细节
- ✅ 第二层不包含UI样式
- ✅ 第三层不包含业务逻辑

### 2. 使用交叉引用

**原则**: 层与层之间通过引用关联

**示例**:
```markdown
第二层 - 6. 数据结构:
参见第一层 - 5. 业务规则 中的工龄计算规则

第三层 - 11. 页面布局:
参见第一层 - 3. 功能清单 中的列表页面功能
```

### 3. 维护版本一致性

**原则**: 三层文档保持版本一致

**示例**:
```markdown
# 版本信息
文档版本: v2.0.0
最后更新: 2026-01-09
三层架构: Functional Spec v2.0 + Technical Spec v2.0 + Design Spec v2.0
```

---

## 🎓 总结

### 三层架构的价值

1. **清晰的关注点分离**
   - 功能、技术、设计各司其职

2. **更好的团队协作**
   - 不同角色关注不同层次

3. **更强的AI理解**
   - 结构化信息便于AI处理

4. **更易维护和更新**
   - 单层修改不影响其他层

5. **更灵活的复用**
   - 可以单独使用某一层

### 下一步

1. ✅ 使用新模板创建新的规范文档
2. ⏳ 逐步将现有文档迁移到三层结构
3. ⏳ 根据使用反馈持续优化

---

**文档版本**: v1.0
**创建人**: AI开发助手
**最后更新**: 2026-01-09
