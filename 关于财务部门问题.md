å®Œç¾ï¼ç°åœ¨æˆ‘å¯ä»¥ç»™ä½ ä¸€ä¸ªå®Œæ•´çš„ç­”æ¡ˆäº†ã€‚

ğŸ“‹ å½“å‰ ApprovalManagement.vue è¯†åˆ«è´¢åŠ¡äººå‘˜çš„æ–¹å¼
âŒ é—®é¢˜ï¼šå½“å‰é¡µé¢æ²¡æœ‰çœŸæ­£è¯†åˆ«è´¢åŠ¡äººå‘˜
ä»ä»£ç åˆ†ææ¥çœ‹ï¼Œå½“å‰é¡µé¢å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. æƒé™åˆ¤æ–­å‡½æ•°ä»…æ£€æŸ¥çŠ¶æ€ï¼Œä¸æ£€æŸ¥ç”¨æˆ·è§’è‰² (utils/index.ts:162-171)

// æ˜¯å¦å¯éƒ¨é—¨å®¡æ‰¹
export function canDeptApprove(status: ExpenseStatus): boolean {
  return status === 'dept_pending'
}

// æ˜¯å¦å¯è´¢åŠ¡å®¡æ‰¹  
export function canFinanceApprove(status: ExpenseStatus): boolean {
  return status === 'finance_pending'
}
è¿™ä¸¤ä¸ªå‡½æ•°åªåˆ¤æ–­æŠ¥é”€å•çŠ¶æ€ï¼Œä¸åˆ¤æ–­å½“å‰ç”¨æˆ·çš„è§’è‰²ï¼

2. é¡µé¢ä¸­çš„ canApprove å‡½æ•° (ApprovalManagement.vue:384-386)

function canApprove(expense: Expense): boolean {
  return expense.status === 'dept_pending' || expense.status === 'finance_pending'
}
åŒæ ·åªæ£€æŸ¥çŠ¶æ€ï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å®¡æ‰¹ã€‚

âœ… æ­£ç¡®çš„è¯†åˆ«æ–¹å¼
æ ¹æ®ç”¨æˆ·ä¿¡æ¯ç»“æ„ (auth/types/index.ts:41-64)ï¼Œä½ æœ‰å‡ ç§æ–¹å¼è¯†åˆ«è´¢åŠ¡äººå‘˜ï¼š

æ–¹å¼1ï¼šé€šè¿‡éƒ¨é—¨IDåˆ¤æ–­

import { useAuthStore } from '@/modules/auth/store'

const authStore = useAuthStore()

// åˆ¤æ–­æ˜¯å¦æ˜¯è´¢åŠ¡éƒ¨å‘˜å·¥
function isFinanceStaff(): boolean {
  return authStore.userInfo?.departmentId === 'DEPT004' // è´¢åŠ¡éƒ¨ID
}
æ–¹å¼2ï¼šé€šè¿‡è§’è‰²åˆ¤æ–­

// åˆ¤æ–­æ˜¯å¦æœ‰è´¢åŠ¡è§’è‰²
function isFinanceStaff(): boolean {
  return authStore.hasRole('finance') || authStore.hasRole('finance_staff')
}
æ–¹å¼3ï¼šé€šè¿‡æƒé™åˆ¤æ–­

// åˆ¤æ–­æ˜¯å¦æœ‰è´¢åŠ¡å®¡æ‰¹æƒé™
function hasFinanceApprovalPermission(): boolean {
  return authStore.hasPermission('expense:finance:approve')
}
ğŸ”§ å»ºè®®çš„ä¿®å¤æ–¹æ¡ˆ
åœ¨ ApprovalManagement.vue ä¸­æ·»åŠ çœŸæ­£çš„æƒé™æ£€æŸ¥ï¼š


// åœ¨ <script setup> ä¸­å¯¼å…¥ authStore
import { useAuthStore } from '@/modules/auth/store'

const authStore = useAuthStore()

// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¯ä»¥å®¡æ‰¹ï¼ˆç»“åˆæŠ¥é”€å•çŠ¶æ€å’Œç”¨æˆ·è§’è‰²ï¼‰
function canApprove(expense: Expense): boolean {
  // éƒ¨é—¨å®¡æ‰¹é˜¶æ®µï¼šåªæœ‰éƒ¨é—¨ä¸»ç®¡å¯ä»¥å®¡æ‰¹
  if (expense.status === 'dept_pending') {
    return authStore.hasRole('dept_manager') || 
           authStore.userInfo?.departmentId === expense.departmentId
  }
  
  // è´¢åŠ¡å®¡æ‰¹é˜¶æ®µï¼šåªæœ‰è´¢åŠ¡äººå‘˜å¯ä»¥å®¡æ‰¹
  if (expense.status === 'finance_pending') {
    return authStore.userInfo?.departmentId === 'DEPT004' || 
           authStore.hasRole('finance')
  }
  
  return false
}
è¿™æ ·å°±èƒ½çœŸæ­£è¯†åˆ«è´¢åŠ¡äººå‘˜å¹¶æ§åˆ¶æƒé™äº†ï¼